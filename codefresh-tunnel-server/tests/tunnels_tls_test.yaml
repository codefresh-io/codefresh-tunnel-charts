suite: Test tunnels ingress tls secret
templates:
  - tunnels-ingress.yaml
  - tunnels-tls-secret.yaml
tests:
  - it: Should equal to existingSecret when existingSecret is set
    template: tunnels-ingress.yaml
    set:
      tunnels.ingress.enabled: true
      tunnels.subdomainHost: tunnels.example.com
      tunnels.ingress.tls.enabled: true
      tunnels.ingress.tls.existingSecret: my-existing-secret
    asserts:
    - equal:
        path: spec.tls[0].secretName
        value: "my-existing-secret"
  - it: Should create valid cert when tls.cert and tls.key are set
    template: tunnels-tls-secret.yaml
    set:
      tunnels.ingress.enabled: true
      tunnels.subdomainHost: tunnels.example.com
      tunnels.ingress.tls.enabled: true
      tunnels.ingress.tls.cert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0RENDQWNpZ0F3SUJBZ0lVU2VKOG5XT3kxQVV6UWc2cmI2Z01EdzhnWXRzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dqRVlNQllHQTFVRUF3d1BZMkV1WTI5a1pXWnlaWE5vTG1sdk1CNFhEVEl5TURreU56QTVNakkwT0ZvWApEVEkxTURreU56QTVNakkwT0Zvd0lURWZNQjBHQTFVRUF3d1dZMkV0WTJ4cFpXNTBMbU52WkdWbWNtVnphQzVwCmJ6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU0wM25QYlorQzZlWVV5Q0pNOXgKM04xMEpvT2g5NVhuam5XNTVWWk5iN054cTZtNVFtMlpGeUVZRGRScGZmSDA3UnZ4VWVrUVZHVWdsVSt5YnNtMwo5WHFObU5UL3I2NGErSkVPWTd2ZWV6VWZKSlVaZEJ3SHJROXk1YUNueVJDTXBTK0Y1U2lBWGNIQlNXYU52WG01CjVCeERiaS9pSGd4RDZmbFRTUFVtc1hSWWpybjdxOVRTbmpCdld1NDV5OUVGaVh3Mmd3eWJUU3FZNURNdjRyaEUKK3VCZVI1ZHBSYmtjWExtQTFXb2NMZmRsL3VOcCs3aWZtc3FTdlZhMGZKMXc3cEFwc0JpK1kxT21qeHVGODlZQwp0Qkp3U3lxazRlNUJYckJZdmZLb1BDa3BVMlBqWitXYnJjeGx5VjUzS1haY2dhdmtQVXdURzFHUVRwaU0raDZuCm9MRUNBd0VBQWFNWE1CVXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWklodmNOQVFFTEJRQUQKZ2dFQkFCMkh4M1BZRkVQMGVtbkQvVndRc3VVMnlVekx2QU9lMWNadEt4b3BrSndQRnJpeUZNV1NMcHlxTWtPVwo2alV5SDBaaHNkS1FKRTY0MlppclMrdG9IS1Y0N0hML3VPU01HUEdCTkVSQTV5VHlZTk0xMlVkRENlWlJsQXUrCjRqbWlmRFdGV3Q1WlJmNnpDMUV3dS9HMnd1NTJvVTg5K3lEL2Fmakw5TmNLUXhiK1cxbUV4VXlxRGVDZzRDL3EKM3U1MFExeGdRQlJJK1gxTDVMa1dTNGtHT2ZvZ3ZKd0VKRUFjdDlrR0dYR0VDN0dWa1NLbVVSLzE3NHNweVorSAo5cUpMbGd5eDNOb0p3UW12Mno4bnNZS1NxeWJVMEQ0VG9MM1JiYkJlWjVvMlFlZk9ZZnVLakozMWMxQmthR01SCklqRllMY2htblNQZHhSVEE0dUV0ZUhENUh6ND0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
      tunnels.ingress.tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBelRlYzl0bjRMcDVoVElJa3ozSGMzWFFtZzZIM2xlZU9kYm5sVmsxdnMzR3JxYmxDCmJaa1hJUmdOMUdsOThmVHRHL0ZSNlJCVVpTQ1ZUN0p1eWJmMWVvMlkxUCt2cmhyNGtRNWp1OTU3TlI4a2xSbDAKSEFldEQzTGxvS2ZKRUl5bEw0WGxLSUJkd2NGSlpvMjllYm5rSEVOdUwrSWVERVBwK1ZOSTlTYXhkRmlPdWZ1cgoxTktlTUc5YTdqbkwwUVdKZkRhRERKdE5LcGprTXkvaXVFVDY0RjVIbDJsRnVSeGN1WURWYWh3dDkyWCs0Mm43CnVKK2F5cEs5VnJSOG5YRHVrQ213R0w1alU2YVBHNFh6MWdLMEVuQkxLcVRoN2tGZXNGaTk4cWc4S1NsVFkrTm4KNVp1dHpHWEpYbmNwZGx5QnErUTlUQk1iVVpCT21JejZIcWVnc1FJREFRQUJBb0lCQUFtTFZKbUdlYXh4WVVVVgpxSENkY3hBNW5yRHdqM3RCVWJiWDlucVZEMlRoSElMQVF2Nmw2QlY1OE9xNEhVdHJnTHVUOWFOSlJ5T002R1RVCmY2S1NFN0NuZFR3eXlCRG80RGFlM0xTWUhGTFVKL2RuUDZjdUZEWnJ1WkpITzJxeG45MGQ5UkoxSmVjay9penUKMnFrV3BDMU1WWXVVa0tFeFoyaFpIME9Ia1NrLy83TUkyZjNncVZlMlJRYThsVzUxUWxsWXEvTjlDSXF2ekJJWAphbFRYTnFsQ0hTc0EyU1ppZ25lWW5weVdNZ2lORzc1WWptVEZVcWhiRWxGaFpRaXZESCtVYlQyZEttSkpFb3YrCmlXVWd4UFVFZ0ZCRTR2eDlnTkgxZlQwNXJZOTVxVGNXU0RnaUUxVFpSaHh1aGVsNm40emV0T2FoYzJzSlZ5bUYKWDRTck1TRUNnWUVBL3F6SVUrSGMyV3NQcjNCdXpPSTI4bWk3cnBseEtXcW02U3h3UjBvMnl3cGNLcE05Znh0WAp6S01XRC8vQ0RIZDEyZ1lTMjZHMHkzbGZlSmlxU1JsS0UxOE52V09iOTFNMHdKUVpUaS84YTA4SGR3WXROTkM2CkpYcFFYVnJKR0MvMG0xd1UwV25xWnNXK3hrc3dYTzcyM2h0RXFCbkpydWhNQzVkNEkxS1RBaXNDZ1lFQXprajAKYnVha2lFUmwvYmR4UitxTXJMSE1XOVBXZTh0VzMxRzExQzl2L2hNV1p5dFBDZDlPNSs2RHlGWjJkNXc3Q2JLbQpBMnZ3TzdETmxhdVdGOHNJTDB2b2VrTmc2UVl6bGFtWjRud3ZHSkk4dE5WcW91dkQ2L3hqMDBOTkdjeEF3Vi9lCnhhYUFtOGNiQVVDVDMxZWxZbTZBaHFOT29IR2FGUkxYbTM5QkpwTUNnWUF4ZjkvSC9nUnc5ZEFzcDB2QjRzNFAKTzdBTzlaLzdEdEcyVEg3ZVBGeCtCbHQzb3ZxMjg5ZVMzTGZ6RUNEbFQyckduNXVXdU0xdEp3QVpib0xhaG1IUgpkZzR6bTJLN0paOEJOMGZiM0pQUlA2RVJ6MCtHRG5PL3lSQkp0TldWTCt6NUxXS1dlV0duN0JOeWN6YkpPV0VlCk5tcVh5YnRibGFjQ01jU1dDUHl0MVFLQmdBN0V3bHMrUUFGUmhFdkoybDVmdUhxVXNDRFM1Y1F2SnFVT1lJbzAKYXp3eGVhVWhRS05nVFhIbGJhSG1MczBaYmxDZmJhdEpDd1g2L256OHI5NDhOdlhMNVhUN1pmREk5T0IrSi9wRApFY3djakNRV00zQSttT1JJU1kxU2dDNmNwUFl6T3V2RG8rbURNN2UvTzliOW0yV1VxN2IzOGlVaWZQbU5ROHBxCkxldnBBb0dBTzEvdHQ3NWQ5Vis4N0UvWmdXdFU5VzIyK3FlR3h2a3Rtd3REd1dXcGN3azhtZDhsUGc0SkJ1bjIKVnZjYk9hd21lMkRZM3g2UkVDanRWRTJ5ZjFneTl1SmhRcFoveUFTa2M2UkdqbTNYdzdHb1hjNTB6S3FONk0vcAp4ZVR3ZXp6VTM2bWo5a1p0cElmNElwY1dZZFBSYituWXVSVGhyNzA1bkZCeUlWL1ZiYkU9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
    asserts:
    - equal:
        path: data.tls\.crt
        value: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0RENDQWNpZ0F3SUJBZ0lVU2VKOG5XT3kxQVV6UWc2cmI2Z01EdzhnWXRzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dqRVlNQllHQTFVRUF3d1BZMkV1WTI5a1pXWnlaWE5vTG1sdk1CNFhEVEl5TURreU56QTVNakkwT0ZvWApEVEkxTURreU56QTVNakkwT0Zvd0lURWZNQjBHQTFVRUF3d1dZMkV0WTJ4cFpXNTBMbU52WkdWbWNtVnphQzVwCmJ6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU0wM25QYlorQzZlWVV5Q0pNOXgKM04xMEpvT2g5NVhuam5XNTVWWk5iN054cTZtNVFtMlpGeUVZRGRScGZmSDA3UnZ4VWVrUVZHVWdsVSt5YnNtMwo5WHFObU5UL3I2NGErSkVPWTd2ZWV6VWZKSlVaZEJ3SHJROXk1YUNueVJDTXBTK0Y1U2lBWGNIQlNXYU52WG01CjVCeERiaS9pSGd4RDZmbFRTUFVtc1hSWWpybjdxOVRTbmpCdld1NDV5OUVGaVh3Mmd3eWJUU3FZNURNdjRyaEUKK3VCZVI1ZHBSYmtjWExtQTFXb2NMZmRsL3VOcCs3aWZtc3FTdlZhMGZKMXc3cEFwc0JpK1kxT21qeHVGODlZQwp0Qkp3U3lxazRlNUJYckJZdmZLb1BDa3BVMlBqWitXYnJjeGx5VjUzS1haY2dhdmtQVXdURzFHUVRwaU0raDZuCm9MRUNBd0VBQWFNWE1CVXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWklodmNOQVFFTEJRQUQKZ2dFQkFCMkh4M1BZRkVQMGVtbkQvVndRc3VVMnlVekx2QU9lMWNadEt4b3BrSndQRnJpeUZNV1NMcHlxTWtPVwo2alV5SDBaaHNkS1FKRTY0MlppclMrdG9IS1Y0N0hML3VPU01HUEdCTkVSQTV5VHlZTk0xMlVkRENlWlJsQXUrCjRqbWlmRFdGV3Q1WlJmNnpDMUV3dS9HMnd1NTJvVTg5K3lEL2Fmakw5TmNLUXhiK1cxbUV4VXlxRGVDZzRDL3EKM3U1MFExeGdRQlJJK1gxTDVMa1dTNGtHT2ZvZ3ZKd0VKRUFjdDlrR0dYR0VDN0dWa1NLbVVSLzE3NHNweVorSAo5cUpMbGd5eDNOb0p3UW12Mno4bnNZS1NxeWJVMEQ0VG9MM1JiYkJlWjVvMlFlZk9ZZnVLakozMWMxQmthR01SCklqRllMY2htblNQZHhSVEE0dUV0ZUhENUh6ND0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    - equal:
        path: data.tls\.key
        value: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBelRlYzl0bjRMcDVoVElJa3ozSGMzWFFtZzZIM2xlZU9kYm5sVmsxdnMzR3JxYmxDCmJaa1hJUmdOMUdsOThmVHRHL0ZSNlJCVVpTQ1ZUN0p1eWJmMWVvMlkxUCt2cmhyNGtRNWp1OTU3TlI4a2xSbDAKSEFldEQzTGxvS2ZKRUl5bEw0WGxLSUJkd2NGSlpvMjllYm5rSEVOdUwrSWVERVBwK1ZOSTlTYXhkRmlPdWZ1cgoxTktlTUc5YTdqbkwwUVdKZkRhRERKdE5LcGprTXkvaXVFVDY0RjVIbDJsRnVSeGN1WURWYWh3dDkyWCs0Mm43CnVKK2F5cEs5VnJSOG5YRHVrQ213R0w1alU2YVBHNFh6MWdLMEVuQkxLcVRoN2tGZXNGaTk4cWc4S1NsVFkrTm4KNVp1dHpHWEpYbmNwZGx5QnErUTlUQk1iVVpCT21JejZIcWVnc1FJREFRQUJBb0lCQUFtTFZKbUdlYXh4WVVVVgpxSENkY3hBNW5yRHdqM3RCVWJiWDlucVZEMlRoSElMQVF2Nmw2QlY1OE9xNEhVdHJnTHVUOWFOSlJ5T002R1RVCmY2S1NFN0NuZFR3eXlCRG80RGFlM0xTWUhGTFVKL2RuUDZjdUZEWnJ1WkpITzJxeG45MGQ5UkoxSmVjay9penUKMnFrV3BDMU1WWXVVa0tFeFoyaFpIME9Ia1NrLy83TUkyZjNncVZlMlJRYThsVzUxUWxsWXEvTjlDSXF2ekJJWAphbFRYTnFsQ0hTc0EyU1ppZ25lWW5weVdNZ2lORzc1WWptVEZVcWhiRWxGaFpRaXZESCtVYlQyZEttSkpFb3YrCmlXVWd4UFVFZ0ZCRTR2eDlnTkgxZlQwNXJZOTVxVGNXU0RnaUUxVFpSaHh1aGVsNm40emV0T2FoYzJzSlZ5bUYKWDRTck1TRUNnWUVBL3F6SVUrSGMyV3NQcjNCdXpPSTI4bWk3cnBseEtXcW02U3h3UjBvMnl3cGNLcE05Znh0WAp6S01XRC8vQ0RIZDEyZ1lTMjZHMHkzbGZlSmlxU1JsS0UxOE52V09iOTFNMHdKUVpUaS84YTA4SGR3WXROTkM2CkpYcFFYVnJKR0MvMG0xd1UwV25xWnNXK3hrc3dYTzcyM2h0RXFCbkpydWhNQzVkNEkxS1RBaXNDZ1lFQXprajAKYnVha2lFUmwvYmR4UitxTXJMSE1XOVBXZTh0VzMxRzExQzl2L2hNV1p5dFBDZDlPNSs2RHlGWjJkNXc3Q2JLbQpBMnZ3TzdETmxhdVdGOHNJTDB2b2VrTmc2UVl6bGFtWjRud3ZHSkk4dE5WcW91dkQ2L3hqMDBOTkdjeEF3Vi9lCnhhYUFtOGNiQVVDVDMxZWxZbTZBaHFOT29IR2FGUkxYbTM5QkpwTUNnWUF4ZjkvSC9nUnc5ZEFzcDB2QjRzNFAKTzdBTzlaLzdEdEcyVEg3ZVBGeCtCbHQzb3ZxMjg5ZVMzTGZ6RUNEbFQyckduNXVXdU0xdEp3QVpib0xhaG1IUgpkZzR6bTJLN0paOEJOMGZiM0pQUlA2RVJ6MCtHRG5PL3lSQkp0TldWTCt6NUxXS1dlV0duN0JOeWN6YkpPV0VlCk5tcVh5YnRibGFjQ01jU1dDUHl0MVFLQmdBN0V3bHMrUUFGUmhFdkoybDVmdUhxVXNDRFM1Y1F2SnFVT1lJbzAKYXp3eGVhVWhRS05nVFhIbGJhSG1MczBaYmxDZmJhdEpDd1g2L256OHI5NDhOdlhMNVhUN1pmREk5T0IrSi9wRApFY3djakNRV00zQSttT1JJU1kxU2dDNmNwUFl6T3V2RG8rbURNN2UvTzliOW0yV1VxN2IzOGlVaWZQbU5ROHBxCkxldnBBb0dBTzEvdHQ3NWQ5Vis4N0UvWmdXdFU5VzIyK3FlR3h2a3Rtd3REd1dXcGN3azhtZDhsUGc0SkJ1bjIKVnZjYk9hd21lMkRZM3g2UkVDanRWRTJ5ZjFneTl1SmhRcFoveUFTa2M2UkdqbTNYdzdHb1hjNTB6S3FONk0vcAp4ZVR3ZXp6VTM2bWo5a1p0cElmNElwY1dZZFBSYituWXVSVGhyNzA1bkZCeUlWL1ZiYkU9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg=="